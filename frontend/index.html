<!doctype html>
<html lang="en">
<head>

    <title>Document</title>
</head>
<body>


<div class="center">
    <h1>Amazing chat application</h1>
    <h3 id="chat-header">Currently in chat :general</h3>
    <form id="chatroom-selection">

        <label for="chatroom"> CHatroom</label>
        <input type="text" id="chatroom" name="chatroom"><br><br>
        <input type="submit" value="Change room">


    </form>
    <br>
    <textarea class="messagearea"
              readonly name="chatmessages"
              id="chatmessages"
              cols="50" rows="4"
              placeholder="Weelcome to chatroom"></textarea>
    <br>
    <form id="chatroom-message">

        <label for="message"> Meassage</label>
        <input type="text" id="message" name="message"><br><br>
        <input type="submit" value="Send message">


    </form>
</div>

<script type="text/javascript">
    var selectedChat = "general";



    class Event{
        constructor(type,payload) {

            this.type  = type;
            this.payload  = payload;
        }
    }


    function routeEvent(event){

        if (event.type === undefined){
            alert("this event has no TYPE field!!!");
        }
        switch (event.type){
            case "new_message":
                console.log("new message");
                break;
            default:
                alert("unknown event type !!!");
                break;

        }

    }

    function sendEvent(evName,payload){
        const ev = new Event(evName,payload)
        conn.send(JSON.stringify(ev))
    }


    function rio(){
        console.log(conn)
    }
    function changeChatRoom() {
        var newChat = document.getElementById("chatroom");
        if (newChat != null && newChat.value != selectedChat) {
            console.log(newChat);
        }
        return false;

    };

    function sendMessage() {
        var newMess = document.getElementById("message");
        if (newMess != null) {
          sendEvent("send_message",newMess.value)

        }
        return false;

    };

    window.onload = function () {
        document.getElementById("chatroom-selection").onsubmit = changeChatRoom;
        document.getElementById("chatroom-message").onsubmit = sendMessage;

        if (window["WebSocket"]) {
            console.log("Support websocket");

            conn = new WebSocket("ws://" + document.location.host + "/ws");

            conn.onmessage = function (ev) {
              const      eventData = JSON.parse(ev.data)
                const event = Object.assign(new Event,eventData)

                routeEvent(event)

            }
            console.log("done");

        } else {
            alert("Browser doesn't support websockket")
        }
    };


</script>

<style type="text/css" >


    body {
        overflow: hidden;
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        background: greenyellow;
    }

    .center {
        margin: auto;
        width: 90%;
        padding: 10px;
        border: 3px solid indianred;
    }
</style>
</body>
</html>